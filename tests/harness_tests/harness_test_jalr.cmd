# jalr instruction format: iiii iiii iiii ssss s000 dddd d110 0111
#                          1100 0000 0000
#                          1098 7654 3210

# ################################################################

# Test with positive displacement
# jal x1, x2, +6
# disp = 0000 0000 0110
# 0000 0000 0110 0001 0000 0000 1110 0111

x1 = 1111111111111111
x2 = 0000000000800000
m 0000000000002000 = 006100E7
pc = 0000000000002000
.
pc    # expect 0x0000000000800006
x1    # expect 0x0000000000002004
x2    # expect 0x0000000000800000

# Test with unaligned positive displacement
# jalr x1, x2, +5
# disp = 0000 0000 0101
# 0000 0000 0101 0001 0000 0000 1110 0111

x1 = 1111111111111111
x2 = 0000000000800000
m 0000000000002010 = 005100E7
pc = 0000000000002010
.
pc    # expect 0x0000000000800004
x1    # expect 0x0000000000002014
x2    # expect 0x0000000000800000

# Test with positive displacement, rs1 is x0
# jalr x1, x0, +6
# disp = 0000 0000 0110
# 0000 0000 0110 0000 0000 0000 1110 0111

x1 = 1111111111111111
m 0000000000002020 = 006000E7
pc = 0000000000002020
.
pc    # expect 0x0000000000000006
x1    # expect 0x0000000000002024

# Test with positive displacement, rd is x0
# jalr x0, x2, +6
# disp = 0000 0000 0110
# 0000 0000 0110 0001 0000 0000 0110 0111

x2 = 0000000000800000
m 0000000000002030 = 00610067
pc = 0000000000002030
.
pc    # expect 0x0000000000800006
x0    # expect unchanged
x2    # expect 0x0000000000800000

# ################################################################

# Test with negative displacement
# jalr x1, x2, -6
# disp = 1111 1111 1010
# 1111 1111 1010 0001 0000 0000 1110 0111

x1 = 1111111111111111
x2 = 0000000000800000
m 0000000000002040 = FFA100E7
pc = 0000000000002040
.
pc    # expect 0x00000000007FFFFA
x1    # expect 0x0000000000002044
x2    # expect 0x0000000000800000

# Test with unaligned negative displacement
# jalr x1, x2, -5
# disp = 1111 1111 1011
# 1111 1111 1011 0001 0000 0000 1110 0111

x1 = 1111111111111111
x2 = 0000000000800000
m 0000000000002050 = FFB100E7
pc = 0000000000002050
.
pc    # expect 0x00000000007FFFFA
x1    # expect 0x0000000000002054
x2    # expect 0x0000000000800000

# Test with negative displacement, rs1 is x0
# jalr x1, x0, -6
# disp = 1111 1111 1010
# 1111 1111 1010 0000 0000 0000 1110 0111

x1 = 1111111111111111
m 0000000000002060 = FFA000E7
pc = 0000000000002060
.
pc    # expect 0xFFFFFFFFFFFFFFFA
x1    # expect 0x0000000000002064

# Test with negative displacement, rd is x0
# jalr x0, x2, -6
# disp = 1111 1111 1010
# 1111 1111 1010 0001 0000 0000 0110 0111

x2 = 00800000
m 0000000000002070 = FFA10067
pc = 0000000000002070
.
pc    # expect 0x00000000007FFFFA
x0    # expect unchanged
x2    # expect 0x0000000000800000
